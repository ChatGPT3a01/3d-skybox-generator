# 亮言~3D環景球生成器 - 操作步驟

## 📌 專案簡介

**亮言~3D環景球生成器**是一個本地端的 360° 全景圖轉換工具，可以將您的 360° 全景圖片一鍵生成 VR 編輯器支援的 3D 環景球 GLB 檔案。

### ✨ 主要功能

- ✅ 上傳 360° 全景圖片（JPG、PNG）
- ✅ 自動整合環景球模板
- ✅ 一鍵生成 GLB 檔案
- ✅ 即時預覽功能
- ✅ 完全本地端執行，無需網路連線
- ✅ 操作簡單，三步驟完成

---

## 💻 系統需求

### 必要條件

- **作業系統**：Windows、macOS、Linux 皆可
- **瀏覽器**：Chrome、Edge、Firefox、Safari（建議使用 Chrome 或 Edge）
- **本地伺服器**：Python、Node.js、PHP 或 VS Code Live Server

### 推薦環境

- Windows 10/11
- Python 3.x（已安裝 Python 3.10.11）
- 最新版本的 Chrome 瀏覽器

---

## 🚀 部署與安裝

### 📁 檔案結構

專案資料夾應包含以下檔案：

```
環景球/
├── index.html                      # 生成器主程式
├── 啟動伺服器.bat                  # 一鍵啟動腳本（推薦使用）
├── logo.png                        # 啟動畫面 Logo
├── 作者資訊.png                    # 作者照片
├── Spatial Skybox Sample.gltf      # 環景球模板（必要）
├── Spatial Skybox Sample.bin       # 幾何數據（必要）
├── texture.jpg                     # 範例貼圖（可選）
└── 操作步驟.md                     # 本說明文件
```

### 📥 安裝步驟

**本工具無需安裝**，所有功能已整合在 `index.html` 單一檔案中。

您只需要：
1. ✅ 確保 `index.html`、`Spatial Skybox Sample.gltf` 和 `Spatial Skybox Sample.bin` 在同一目錄
2. ✅ 準備好您的 360° 全景圖片
3. ✅ 選擇一種方式啟動本地伺服器（見下方）

---

## 🎯 啟動方法

由於瀏覽器的 **CORS 安全限制**，無法直接雙擊開啟 HTML 檔案，必須透過本地伺服器執行。

### 方法 1：一鍵啟動腳本（最簡單 ⭐⭐⭐）

**適用於**：Windows 使用者（已安裝 Python 3.10.11）

#### 步驟：

1. **找到專案資料夾中的 `啟動伺服器.bat` 檔案**
2. **雙擊執行**
3. **會自動開啟命令視窗並顯示：**
   ```
   ========================================
     亮言~3D環景球生成器
     伺服器啟動程式
   ========================================

   [啟動中] 正在啟動本地伺服器...

   ✓ 伺服器啟動成功！

   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
     請在瀏覽器開啟以下網址：

     http://localhost:9527/index.html
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   💡 提示：
     - 按 Ctrl+C 可停止伺服器
     - 關閉此視窗也會停止伺服器
   ```

4. **複製網址到瀏覽器**
   - 在瀏覽器開啟：`http://localhost:9527/index.html`

#### 關閉伺服器：
- 按 `Ctrl + C` 或直接關閉命令視窗即可停止

---

### 方法 2：Python 手動啟動

**適用於**：已安裝 Python 的使用者

#### 步驟：

1. **開啟命令提示字元（CMD）或終端機**
   - Windows：按 `Win + R`，輸入 `cmd`，按 Enter
   - 或在檔案總管中，於專案資料夾按住 `Shift + 右鍵`，選擇「在此處開啟命令視窗」或「在終端機開啟」

2. **切換到專案目錄**
   ```bash
   cd D:\程式\環景球
   ```

3. **啟動 Python 伺服器**
   ```bash
   python -m http.server 9527
   ```

4. **開啟瀏覽器**
   - 在瀏覽器網址列輸入：`http://localhost:9527/index.html`
   - 或直接點擊：[http://localhost:9527/index.html](http://localhost:9527/index.html)

5. **看到以下訊息表示成功**
   ```
   Serving HTTP on :: port 9527 (http://[::]:9527/) ...
   ```
   **注意**：看到這個訊息後，請手動在瀏覽器開啟 `http://localhost:9527/index.html`

#### 關閉伺服器：
- 在命令提示字元按 `Ctrl + C` 即可停止

---

### 方法 2：VS Code Live Server

**適用於**：使用 Visual Studio Code 的開發者

#### 步驟：

1. **安裝 Live Server 擴充功能**
   - 開啟 VS Code
   - 點擊左側「擴充功能」圖示（或按 `Ctrl + Shift + X`）
   - 搜尋 "Live Server"
   - 點擊「安裝」

2. **啟動伺服器**
   - 在 VS Code 中開啟 `index.html` 檔案
   - 右鍵點擊檔案內容
   - 選擇「Open with Live Server」
   - 或點擊右下角的「Go Live」按鈕

3. **自動開啟瀏覽器**
   - 預設會在 `http://127.0.0.1:5500/index.html` 開啟

---

### 方法 3：Node.js http-server

**適用於**：已安裝 Node.js 的使用者

#### 步驟：

1. **安裝 http-server（首次使用）**
   ```bash
   npm install -g http-server
   ```

2. **切換到專案目錄**
   ```bash
   cd D:\程式\環景球
   ```

3. **啟動伺服器**
   ```bash
   http-server -p 9527
   ```

4. **開啟瀏覽器**
   - 訪問：`http://localhost:9527/index.html`

---

## 📝 操作步驟

### ⚡ 簡單三步驟

#### 步驟 1：啟動工具

使用上述任一方法啟動本地伺服器，並在瀏覽器開啟 `index.html`。

頁面會自動檢查並載入環景球模板檔案：
- ✅ `Spatial Skybox Sample.gltf`
- ✅ `Spatial Skybox Sample.bin`

如果看到「✅ 環景球模板載入成功！」訊息，表示準備就緒。

#### 步驟 2：上傳 360° 全景圖

您有兩種上傳方式：

**方式 A：點擊上傳**
- 點擊畫面中央的「🖼️ 上傳您的 360° 全景圖」區域
- 在檔案選擇器中選擇您的 360° 全景圖（支援 JPG、PNG 格式）
- 點擊「開啟」

**方式 B：拖曳上傳**
- 直接將圖片檔案從檔案總管拖曳到上傳區域
- 放開滑鼠即可

上傳成功後會顯示圖片預覽和檔案資訊。

#### 步驟 3：生成 GLB 檔案

- 確認預覽圖片正確
- 點擊「🚀 生成 GLB 檔案」按鈕
- 等待處理（通常只需 1-3 秒）
- 系統會自動下載 `skybox.glb` 檔案

### ✅ 完成！

下載的 `skybox.glb` 檔案可以直接上傳到您的 VR 編輯器使用。

---

## 🎨 支援的圖片格式

### 圖片類型
- ✅ JPEG / JPG
- ✅ PNG

### 推薦規格
- **投影類型**：等距圓柱投影（Equirectangular）
- **長寬比**：2:1（例如：4096×2048、8192×4096）
- **解析度**：建議 4K 以上（4096×2048 或更高）
- **檔案大小**：建議小於 10MB 以確保流暢處理

### 什麼是等距圓柱投影？

等距圓柱投影是將球形的 360° 全景圖展開成平面矩形的方式，就像世界地圖一樣。如果您的圖片看起來像這樣：
- 長度是高度的兩倍（2:1 比例）
- 上下部分（天空和地面）會有拉伸變形
- 中間部分（視線水平）較正常

那就是正確的格式！

### 範例圖片來源
如果您需要測試圖片：
- [Poly Haven](https://polyhaven.com/hdris) - 免費高品質 360° HDRIs
- [360° Stock Photos](https://www.360cities.net/) - 360° 照片素材
- AI 生成工具（如 Midjourney、DALL-E）也可以生成 360° 全景圖

---

## ❓ 常見問題排解

### Q1：無法開啟 index.html，顯示一片空白？

**原因**：直接雙擊開啟 HTML 檔案會觸發 CORS 安全限制。

**解決方法**：
- ✅ 必須透過本地伺服器開啟（參考「啟動方法」章節）
- ❌ 不要直接雙擊 HTML 檔案

---

### Q2：顯示「模板檔案載入失敗」？

**可能原因**：
1. `Spatial Skybox Sample.gltf` 或 `Spatial Skybox Sample.bin` 不在同一目錄
2. 檔案名稱不正確
3. 檔案損壞

**解決方法**：
- 確認所有檔案都在同一個資料夾
- 檢查檔案名稱是否完全一致（包括大小寫和空格）
- 重新下載範例檔案

---

### Q3：上傳圖片後顯示「載入失敗」或無法預覽？

**可能原因**：
1. 圖片格式不支援（只支援 JPG、PNG）
2. 圖片檔案損壞
3. 檔案過大導致瀏覽器記憶體不足

**解決方法**：
- 確認圖片格式正確
- 嘗試壓縮圖片（建議小於 10MB）
- 使用圖片編輯軟體重新存檔
- 使用另一張圖片測試

---

### Q4：生成 GLB 後沒有自動下載？

**可能原因**：
- 瀏覽器封鎖了自動下載

**解決方法**：
- 檢查瀏覽器網址列是否有「已封鎖下載」通知
- 點擊通知允許下載
- 或在瀏覽器設定中允許 localhost 自動下載

**Chrome 設定步驟**：
1. 點擊網址列右側的「🔒」圖示
2. 找到「自動下載」選項
3. 設定為「允許」

---

### Q5：下載的 GLB 檔案無法在 VR 編輯器中使用？

**可能原因**：
1. VR 編輯器不支援 GLB 格式
2. 檔案下載不完整
3. 原始圖片格式不正確

**解決方法**：
- 確認 VR 編輯器支援 GLB 格式
- 檢查下載的檔案大小是否合理（通常 > 1MB）
- 重新生成並下載
- 確認原始圖片是等距圓柱投影格式
- 檢查 VR 編輯器的匯入設定

---

### Q6：Python 指令無法執行？

**可能原因**：
- Python 未安裝或未加入環境變數

**解決方法**：

1. **檢查 Python 是否安裝**
   ```bash
   python --version
   ```
   如果顯示版本號（例如：Python 3.10.11）表示已安裝

2. **如果未安裝 Python**
   - 下載：[https://www.python.org/downloads/](https://www.python.org/downloads/)
   - 安裝時**務必勾選「Add Python to PATH」**

3. **如果指令仍無法執行**
   - 嘗試使用 `python3` 而非 `python`：
     ```bash
     python3 -m http.server 9527
     ```
   - 或使用其他方式（VS Code Live Server、Node.js）

---

### Q7：生成的環景球方向或效果不正確？

**原因**：
- 圖片可能不是標準的等距圓柱投影格式
- 或者圖片方向被旋轉了

**解決方法**：
- 確認原始圖片是 360° 等距圓柱投影（Equirectangular）格式
- 檢查圖片長寬比是否為 2:1
- 使用專業工具（如 Adobe Photoshop、PTGui）調整圖片格式
- 嘗試旋轉圖片 90° 或 180° 後重新生成

---

### Q8：想要更換圖片重新生成？

**方法 1**：點擊「更換圖片」按鈕
- 在預覽區域下方點擊「更換圖片」按鈕
- 選擇新的圖片即可

**方法 2**：重新整理頁面
- 按 `F5` 或點擊瀏覽器重新整理按鈕
- 重新上傳新圖片

---

## 🔧 技術說明

### 技術堆疊

- **Three.js** - 3D 圖形庫（版本 0.160.0）
- **GLTFLoader** - glTF 格式載入器
- **GLTFExporter** - GLB 格式導出器
- **HTML5 Canvas** - 圖片處理
- **Pure HTML/CSS/JavaScript** - 無需額外依賴

### 工作原理

1. **模板載入**：頁面啟動時自動檢查並載入環景球模板（Sample.gltf 和 Sample.bin）
2. **圖片上傳**：用戶上傳 360° 全景圖，系統將其轉換為 Data URL
3. **動態整合**：將用戶圖片替換到模板的貼圖引用中
4. **場景建立**：使用 Three.js 載入修改後的 glTF 場景
5. **GLB 導出**：使用 GLTFExporter 將場景導出為二進位 GLB 格式
6. **自動下載**：觸發瀏覽器下載生成的 GLB 檔案

### 環景球技術原理

環景球（Skybox）是 VR 和 3D 場景中常用的技術：

1. **球體幾何**：建立一個大型球體包圍觀察者
2. **內側渲染**：將材質設定為 `THREE.BackSide`，貼圖渲染在球體內側
3. **UV 映射**：將 2D 全景圖（等距圓柱投影）映射到 3D 球體表面
4. **沉浸體驗**：觀察者站在球心，環顧四周即可看到完整的 360° 場景

### 檔案格式說明

#### GLB（GL Transmission Format Binary）
- 二進位格式，所有資源（幾何、貼圖、材質）打包在單一檔案中
- 檔案結構：JSON chunk + Binary chunk
- **優點**：
  - 單檔案方便傳輸和管理
  - 載入速度快
  - 廣泛支援（Unity、Unreal、Web、VR平台）
- **缺點**：
  - 無法單獨修改內部資源
  - 檔案較大

#### 為什麼使用 GLB？
- VR 編輯器（如 Spatial、Mozilla Hubs、VRChat）通常只支援單檔案上傳
- GLB 是最通用的 3D 模型交換格式
- 符合 Khronos Group 的 glTF 2.0 標準

---

## 📚 進階使用

### 批次生成

如果您需要生成多個環景球：
1. 上傳第一張圖片並生成 GLB
2. 點擊「更換圖片」按鈕
3. 上傳下一張圖片
4. 重複操作

**建議**：為每個生成的 GLB 檔案重新命名，以便區分。

### 自訂輸出檔名

目前工具預設輸出檔名為 `skybox.glb`。

如需自訂檔名，可以修改 `index.html` 中的這一行：

```javascript
// 找到這一行（約在 572 行）：
downloadFile(glbBlob, 'skybox.glb');

// 改為您想要的檔名：
downloadFile(glbBlob, '我的環景球.glb');
```

或根據上傳的圖片名稱自動命名：

```javascript
const outputFilename = uploadedImageFile.name.replace(/\.(jpg|jpeg|png)$/i, '.glb');
downloadFile(glbBlob, outputFilename);
```

### 調整環景球大小

如果需要修改環景球的球體大小，可以編輯 `Spatial Skybox Sample.gltf` 檔案。

**注意**：這是進階操作，建議備份原檔案。

### 優化圖片品質

為了獲得最佳效果：

1. **使用高解析度圖片**
   - 建議 4K（4096×2048）或更高
   - 8K（8192×4096）效果最佳，但檔案較大

2. **圖片壓縮**
   - 使用工具壓縮圖片以平衡品質和檔案大小
   - 推薦工具：TinyPNG、ImageOptim、Photoshop

3. **格式選擇**
   - JPG：適合照片，檔案較小
   - PNG：適合電腦生成圖像，品質較高但檔案較大

---

## 🎓 使用場景

### 適合用途

- ✅ VR 虛擬展覽空間背景
- ✅ 元宇宙平台環境設計
- ✅ 3D 遊戲天空盒
- ✅ 建築可視化環境
- ✅ 360° 全景照片展示
- ✅ AI 生成場景快速預覽

### 支援的 VR 平台

已測試可用的平台：
- **Spatial** - 虛擬空間創建平台
- **Mozilla Hubs** - 開源 VR 社交平台
- **VRChat** - VR 社交遊戲
- **Unity** - 遊戲引擎（需匯入為 Skybox）
- **Unreal Engine** - 遊戲引擎
- **Blender** - 3D 建模軟體

---

## 📞 疑難排解檢查清單

如果遇到問題，請按以下順序檢查：

### 基本檢查
- [ ] 是否使用本地伺服器開啟（不是直接雙擊 HTML）
- [ ] 瀏覽器版本是否為最新版
- [ ] 所有檔案是否在同一目錄（index.html、Sample.gltf、Sample.bin）
- [ ] 檔案名稱是否正確（包括大小寫和空格）

### 圖片檢查
- [ ] 圖片格式是否為 JPG 或 PNG
- [ ] 圖片是否為等距圓柱投影格式
- [ ] 圖片長寬比是否為 2:1
- [ ] 檔案大小是否過大（建議 < 10MB）

### 網路檢查
- [ ] 本地伺服器是否正常運行
- [ ] 能否訪問 Three.js CDN（需要網路連線載入 Three.js 庫）
- [ ] 防火牆是否封鎖 localhost 連線

### 瀏覽器主控台檢查

如果仍有問題，請檢查瀏覽器主控台：

1. 按 `F12` 開啟開發者工具
2. 切換到「Console」分頁
3. 查看是否有錯誤訊息（紅色文字）
4. 將錯誤訊息記錄下來以便除錯

常見錯誤訊息及解決方法：
- `CORS policy`: 未使用本地伺服器
- `Failed to fetch`: 檔案不存在或路徑錯誤
- `Out of memory`: 圖片檔案過大

---

## 📖 相關資源

### 學習資源
- [Three.js 官方文件](https://threejs.org/docs/)
- [glTF 格式規範](https://www.khronos.org/gltf/)
- [360° 攝影教學](https://www.360cities.net/tutorial)
- [等距圓柱投影說明](https://zh.wikipedia.org/wiki/%E7%AD%89%E8%B7%9D%E5%9C%86%E6%9F%B1%E6%8A%95%E5%BD%B1)

### 相關工具
- [PTGui](https://www.ptgui.com/) - 全景圖拼接工具
- [Blender](https://www.blender.org/) - 免費 3D 建模軟體
- [Poly Haven](https://polyhaven.com/) - 免費 HDRIs 素材

### AI 生成 360° 圖片
- [Skybox AI](https://skybox.blockadelabs.com/) - AI 生成 360° 天空盒
- [Midjourney](https://www.midjourney.com/) - 使用 `--ar 2:1` 參數
- [Stable Diffusion](https://stability.ai/) - 搭配 360° 全景模型

---

## 🎉 完成！

您現在已經了解如何使用**亮言~3D環景球生成器**！

### 快速回顧

**三步驟輕鬆完成**：
1. ✅ 雙擊執行 `啟動伺服器.bat`（或手動執行 `python -m http.server 9527`）
2. ✅ 在瀏覽器開啟 `http://localhost:9527/index.html`
3. ✅ 上傳 360° 全景圖 → 預覽 → 生成 GLB

**工作流程**：
```
準備全景圖 → 上傳到工具 → 自動整合模板 → 一鍵生成 GLB → 下載使用
```

**檔案結構**：
```
環景球/
├── 啟動伺服器.bat                # 雙擊啟動（最簡單）
├── index.html                    # 主程式（保持不變）
├── Spatial Skybox Sample.gltf    # 模板（保持不變）
├── Spatial Skybox Sample.bin     # 模板（保持不變）
└── 您的全景圖.jpg                # 隨時更換
```

---

## 💡 小技巧

1. **最簡單啟動**：使用 `啟動伺服器.bat` 一鍵啟動，會自動顯示網址提示
2. **快速測試**：先用一張小尺寸圖片測試流程，確認沒問題後再使用高解析度圖片
3. **批次處理**：準備好多張圖片，依序上傳生成，並在下載後立即重新命名
4. **效果預覽**：生成的 GLB 可以用 [glTF Viewer](https://gltf-viewer.donmccurdy.com/) 線上預覽
5. **備份模板**：建議備份一份 Sample.gltf 和 Sample.bin 檔案，以防意外損壞

---

## 📄 版本資訊

**目前版本**：1.0
**最後更新**：2026年1月

### 更新日誌
- v1.0 (2026/01) - 首次發布
  - 支援 JPG、PNG 格式上傳
  - 自動載入環景球模板
  - 一鍵生成 GLB 檔案
  - 圖片預覽功能
  - 完整錯誤提示

---

## ❤️ 感謝使用

感謝您使用**亮言~3D環景球生成器**！

如果這個工具對您有幫助，歡迎分享給需要的朋友。

祝您創作愉快！🚀✨

---

## 👨‍🏫 關於作者

### 曾慶良 主任（阿亮老師）

**現任職務：**
- 📌 新興科技推廣中心主任
- 📌 教育部學科中心所長教師
- 📌 臺北市語文學習領域輔導員

**獲獎紀錄：**
- 🏆 2024年 獲教育部人工智慧講師認證
- 🏆 2022、2023年 指導學生XR專題競賽獲特優
- 🏆 2022年 獲VR教材開發教師組特優
- 🏆 2019年 獲百大資訊人才獎
- 🏆 2018、2019年 蟬聯天下創新100教師
- 🏆 2018年 臺北市特殊優良教師
- 🏆 2017年 教育部行動學習優等

### 📞 聯絡方式

- **YouTube 頻道**：[https://www.youtube.com/@Liang-yt02](https://www.youtube.com/@Liang-yt02)
- **3A科技研究社**：[https://www.facebook.com/groups/2754139931432955](https://www.facebook.com/groups/2754139931432955)
- **課程、研習邀約**：3a01chatgpt@gmail.com

---

## 📜 授權聲明

**© 2026 阿亮老師 版權所有**

本專案僅供「阿亮老師課程學員」學習使用。

### ⚠️ 禁止事項

- ❌ 禁止修改本專案內容
- ❌ 禁止轉傳或散布
- ❌ 禁止商業使用
- ❌ 禁止未經授權之任何形式使用

如有任何授權需求，請聯繫作者。

---

**本文件最後更新：2026年1月**
